<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TripFactory Organisational Structure - Editor</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #1a365d;
            --primary-light: #2c5282;
            --accent: #ed8936;
            --success: #38a169;
            --warning: #d69e2e;
            --danger: #e53e3e;
            --bg: #f7fafc;
            --card: #ffffff;
            --text: #2d3748;
            --text-light: #718096;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            --shadow-lg: 0 20px 25px -5px rgba(0,0,0,0.1);
        }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding-top: 180px;
            line-height: 1.6;
        }
        
        .command-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
        }
        
        .header-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 24px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .brand {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .logo-container {
            background: white;
            padding: 8px 16px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 48px;
            min-width: 140px;
        }
        
        .logo-container img {
            max-height: 32px;
            max-width: 120px;
            object-fit: contain;
        }
        
        .logo-fallback {
            font-weight: 800;
            color: var(--primary);
            font-size: 1.1em;
            letter-spacing: -0.5px;
        }
        
        .header-title {
            font-size: 1.25em;
            font-weight: 600;
            opacity: 0.95;
        }
        
        .header-subtitle {
            font-size: 0.85em;
            opacity: 0.7;
            font-weight: 400;
        }
        
        .search-container {
            flex: 1;
            max-width: 400px;
            margin: 0 24px;
        }
        
        .search-box {
            width: 100%;
            padding: 10px 16px 10px 40px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 0.95em;
            transition: all 0.2s;
        }
        
        .search-box::placeholder { color: rgba(255,255,255,0.6); }
        .search-box:focus {
            outline: none;
            border-color: rgba(255,255,255,0.4);
            background: rgba(255,255,255,0.15);
        }
        
        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.6;
        }
        
        .search-wrapper { position: relative; }
        
        .header-controls {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .header-stats {
            display: flex;
            gap: 12px;
        }
        
        .stat-pill {
            background: rgba(255,255,255,0.1);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85em;
            display: flex;
            align-items: center;
            gap: 6px;
            backdrop-filter: blur(10px);
        }
        
        .stat-value {
            font-weight: 700;
            font-size: 1.1em;
        }
        
        .btn-group {
            display: flex;
            gap: 8px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }
        
        .btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .btn-primary { background: #4299e1; color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-secondary { background: rgba(255,255,255,0.15); color: white; }
        
        .save-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 24px;
            font-size: 1em;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.4); }
            50% { box-shadow: 0 0 0 10px rgba(102, 126, 234, 0); }
        }
        
        .dept-nav {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 1px;
            background: rgba(255,255,255,0.1);
        }
        
        .dept-nav-item {
            padding: 14px 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            background: rgba(255,255,255,0.05);
        }
        
        .dept-nav-item:hover { background: rgba(255,255,255,0.1); }
        .dept-nav-item.active {
            background: rgba(255,255,255,0.2);
        }
        .dept-nav-item.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 20%;
            right: 20%;
            height: 3px;
            background: white;
            border-radius: 3px 3px 0 0;
        }
        
        .dept-icon { font-size: 1.3em; margin-bottom: 4px; }
        .dept-name { font-size: 0.7em; font-weight: 600; text-transform: uppercase; opacity: 0.9; letter-spacing: 0.5px; }
        .dept-count { font-size: 1.4em; font-weight: 700; margin-top: 2px; }
        
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }
        
        .toast-container {
            position: fixed;
            top: 200px;
            right: 24px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .toast {
            background: white;
            padding: 16px 20px;
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            animation: slideIn 0.3s ease;
            border-left: 4px solid var(--success);
        }
        
        .toast.warning { border-left-color: var(--warning); }
        .toast.error { border-left-color: var(--danger); }
        .toast.info { border-left-color: #4299e1; }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .pending-changes {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--warning);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            display: none;
            align-items: center;
            gap: 12px;
            z-index: 2000;
            font-weight: 600;
        }
        
        .pending-changes.active { display: flex; }
        
        .leadership-section {
            background: linear-gradient(135deg, var(--primary) 0%, #2d3748 100%);
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 32px;
            color: white;
            box-shadow: var(--shadow-lg);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        
        .section-title {
            font-size: 1.3em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .leadership-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
        }
        
        .leader-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s;
        }
        
        .leader-card:hover {
            transform: translateY(-2px);
            background: rgba(255,255,255,0.15);
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
        }
        
        .leader-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }
        
        .leader-name {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .leader-role {
            font-size: 0.9em;
            opacity: 0.85;
        }
        
        .leader-badge {
            background: rgba(255,255,255,0.2);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
        }
        
        .leader-form {
            display: grid;
            gap: 10px;
            margin-top: 12px;
        }
        
        .form-select-dark {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 6px;
            background: rgba(0,0,0,0.2);
            color: white;
            font-size: 0.9em;
            cursor: pointer;
        }
        
        .form-select-dark option { background: #2d3748; color: white; }
        
        .dept-section {
            background: var(--card);
            border-radius: 16px;
            margin-bottom: 28px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: box-shadow 0.3s;
        }
        
        .dept-section:hover { box-shadow: var(--shadow-lg); }
        
        .dept-header {
            padding: 20px 24px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }
        
        .dept-title-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .dept-icon-large { font-size: 1.5em; }
        .dept-title { font-size: 1.25em; font-weight: 600; }
        
        .dept-meta {
            display: flex;
            gap: 16px;
            font-size: 0.9em;
        }
        
        .dept-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(255,255,255,0.15);
            padding: 6px 14px;
            border-radius: 20px;
        }
        
        .dept-body { padding: 20px; }
        
        .role-group {
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 16px;
            overflow: hidden;
            transition: all 0.2s;
        }
        
        .role-group:hover { border-color: #cbd5e0; }
        .role-group.expanded { border-color: #4299e1; border-width: 2px; }
        
        .role-header {
            background: linear-gradient(to right, #f7fafc, #edf2f7);
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .role-group.expanded .role-header {
            background: linear-gradient(to right, #ebf8ff, #e6fffa);
        }
        
        .role-title-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .role-count {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.95em;
            min-width: 40px;
            text-align: center;
        }
        
        .role-name { font-weight: 600; color: var(--text); font-size: 1em; }
        
        .expand-icon {
            transition: transform 0.3s;
            color: var(--text-light);
            font-size: 1.2em;
        }
        
        .role-group.expanded .expand-icon { transform: rotate(180deg); }
        
        .role-members {
            display: none;
            max-height: 600px;
            overflow-y: auto;
            background: white;
        }
        
        .role-group.expanded .role-members { display: block; }
        
        .person-card {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            display: grid;
            grid-template-columns: 1fr 1.5fr auto;
            gap: 16px;
            align-items: start;
            transition: all 0.2s;
            position: relative;
        }
        
        @media (max-width: 1200px) {
            .person-card { grid-template-columns: 1fr; }
        }
        
        .person-card:hover { background: #f7fafc; }
        .person-card:last-child { border-bottom: none; }
        
        .person-card.inactive {
            background: #fff5f5;
            opacity: 0.7;
        }
        
        .person-card.modified {
            border-left: 4px solid var(--accent);
            background: #fffaf0;
        }
        
        .person-main { min-width: 0; }
        
        .person-name {
            font-weight: 600;
            color: var(--text);
            font-size: 1em;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .person-original {
            font-size: 0.8em;
            color: var(--text-light);
            text-decoration: line-through;
            margin-top: 2px;
        }
        
        .person-form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        @media (max-width: 600px) {
            .person-form-grid { grid-template-columns: 1fr; }
        }
        
        .form-control {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.9em;
            transition: all 0.2s;
            background: white;
        }
        
        .form-control:focus {
            border-color: #4299e1;
            outline: none;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }
        
        .checkbox-group-inline {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .checkbox-pill {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: white;
            border: 2px solid var(--border);
            border-radius: 20px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }
        
        .checkbox-pill:hover { border-color: #4299e1; }
        .checkbox-pill.checked {
            background: #ebf8ff;
            border-color: #4299e1;
            color: #2b6cb0;
            font-weight: 600;
        }
        
        .checkbox-pill input { display: none; }
        
        .person-actions {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .action-btn {
            width: 34px;
            height: 34px;
            border: 2px solid var(--border);
            background: white;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .action-btn:hover { transform: scale(1.05); }
        .action-btn.validate { border-color: var(--success); color: var(--success); }
        .action-btn.validate:hover, .action-btn.validate.active { background: var(--success); color: white; }
        .action-btn.reject { border-color: var(--danger); color: var(--danger); }
        .action-btn.reject:hover, .action-btn.reject.active { background: var(--danger); color: white; }
        .action-btn.inactive-btn { border-color: var(--warning); color: var(--warning); }
        .action-btn.inactive-btn:hover, .action-btn.inactive-btn.active { background: var(--warning); color: white; }
        
        .modified-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: var(--accent);
            color: white;
            font-size: 0.7em;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 8px;
            font-weight: 600;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 3000;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }
        
        .modal-overlay.active { display: flex; }
        
        .modal {
            background: white;
            border-radius: 16px;
            padding: 24px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border);
        }
        
        .modal-title { font-size: 1.25em; font-weight: 600; }
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: var(--text-light);
        }
        
        .modal-body { margin-bottom: 20px; }
        .modal-footer { display: flex; justify-content: flex-end; gap: 12px; }
        
        .change-list {
            max-height: 300px;
            overflow-y: auto;
            background: #f7fafc;
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
        }
        
        .change-item {
            padding: 8px;
            border-bottom: 1px solid var(--border);
            font-size: 0.9em;
        }
        
        .change-item:last-child { border-bottom: none; }
        
        .github-instructions {
            background: #f0fff4;
            border: 1px solid #9ae6b4;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            font-size: 0.9em;
        }
        
        .github-instructions h4 {
            color: #22543d;
            margin-bottom: 8px;
        }
        
        .github-instructions ol {
            margin-left: 20px;
            color: #2f855a;
        }
        
        .github-instructions li {
            margin: 4px 0;
        }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e0; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a0aec0; }
        
        @media (max-width: 1200px) {
            .dept-nav { grid-template-columns: repeat(4, 1fr); }
            .search-container { display: none; }
        }
        
        @media (max-width: 768px) {
            body { padding-top: 220px; }
            .dept-nav { grid-template-columns: repeat(2, 1fr); }
            .header-stats { display: none; }
            .header-controls { width: 100%; justify-content: center; flex-wrap: wrap; }
            .btn-group { flex-wrap: wrap; justify-content: center; }
            .leadership-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>
    
    <!-- Pending Changes Indicator -->
    <div class="pending-changes" id="pendingChanges" onclick="openSaveModal()">
        <span>‚ö†Ô∏è</span>
        <span><span id="changeCount">0</span> unsaved changes</span>
        <button class="btn btn-success" style="margin-left: 8px;">Save Now</button>
    </div>

    <!-- Fixed Header -->
    <div class="command-header">
        <div class="header-main">
            <div class="brand">
                <div class="logo-container">
                    <img src="tripfactory-logo.png" alt="TripFactory" onerror="this.style.display='none'; this.parentElement.innerHTML='<span class=\'logo-fallback\'>TripFactory</span>';">
                </div>
                <div>
                    <div class="header-title">Organisational Structure</div>
                    <div class="header-subtitle">Online Editor v2.0</div>
                </div>
            </div>
            
            <div class="search-container">
                <div class="search-wrapper">
                    <span class="search-icon">üîç</span>
                    <input type="text" class="search-box" id="searchBox" placeholder="Search employees..." oninput="handleSearch(this.value)">
                </div>
            </div>
            
            <div class="header-controls">
                <div class="header-stats">
                    <div class="stat-pill">
                        <span>Active</span>
                        <span class="stat-value" id="header-active" style="color: #68d391;">0</span>
                    </div>
                    <div class="stat-pill">
                        <span>Modified</span>
                        <span class="stat-value" id="header-modified" style="color: #fbd38d;">0</span>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="expandAll()">üìÇ Expand</button>
                    <button class="btn btn-secondary" onclick="collapseAll()">üìÅ Collapse</button>
                    <button class="btn btn-warning" onclick="undoLastChange()">‚Ü©Ô∏è Undo</button>
                    <button class="btn save-btn" onclick="openSaveModal()">üíæ Save Changes</button>
                </div>
            </div>
        </div>
        
        <div class="dept-nav">
            <div class="dept-nav-item management" onclick="scrollToDept('management')" data-dept="management">
                <div class="dept-icon">üëî</div>
                <div class="dept-name">Management</div>
                <div class="dept-count" id="quick-mgmt">0</div>
            </div>
            <div class="dept-nav-item tech" onclick="scrollToDept('tech')" data-dept="tech">
                <div class="dept-icon">üíª</div>
                <div class="dept-name">Tech</div>
                <div class="dept-count" id="quick-tech">0</div>
            </div>
            <div class="dept-nav-item finance" onclick="scrollToDept('finance')" data-dept="finance">
                <div class="dept-icon">üí∞</div>
                <div class="dept-name">Finance</div>
                <div class="dept-count" id="quick-finance">0</div>
            </div>
            <div class="dept-nav-item marketing" onclick="scrollToDept('marketing')" data-dept="marketing">
                <div class="dept-icon">üì¢</div>
                <div class="dept-name">Marketing</div>
                <div class="dept-count" id="quick-marketing">0</div>
            </div>
            <div class="dept-nav-item sales" onclick="scrollToDept('sales')" data-dept="sales">
                <div class="dept-icon">üíº</div>
                <div class="dept-name">Sales</div>
                <div class="dept-count" id="quick-sales">0</div>
            </div>
            <div class="dept-nav-item operations" onclick="scrollToDept('operations')" data-dept="operations">
                <div class="dept-icon">‚öôÔ∏è</div>
                <div class="dept-name">Operations</div>
                <div class="dept-count" id="quick-operations">0</div>
            </div>
            <div class="dept-nav-item hr" onclick="scrollToDept('hr')" data-dept="hr">
                <div class="dept-icon">üë•</div>
                <div class="dept-name">HR</div>
                <div class="dept-count" id="quick-hr">0</div>
            </div>
            <div class="dept-nav-item commercial" onclick="scrollToDept('commercial')" data-dept="commercial">
                <div class="dept-icon">ü§ù</div>
                <div class="dept-name">Commercial</div>
                <div class="dept-count" id="quick-commercial">0</div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <div class="leadership-section" id="leadership">
            <div class="section-header">
                <div class="section-title">üëë Executive Leadership</div>
                <div style="font-size: 0.9em; opacity: 0.8;">C-Suite & Founders</div>
            </div>
            <div class="leadership-grid" id="leadership-grid"></div>
        </div>

        <div id="departments-container"></div>
    </div>

    <!-- Save Modal -->
    <div class="modal-overlay" id="saveModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">üíæ Save Changes to GitHub</div>
                <button class="modal-close" onclick="closeSaveModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="github-instructions">
                    <h4>üìã How to save your changes:</h4>
                    <ol>
                        <li>Copy the JSON data below (click the copy button)</li>
                        <li>Go to your GitHub repository</li>
                        <li>Navigate to <code>data/org-structure.json</code></li>
                        <li>Click the ‚úèÔ∏è Edit button</li>
                        <li>Paste the JSON data</li>
                        <li>Scroll down and click "Commit changes"</li>
                        <li>Wait 1-2 minutes, then refresh this page</li>
                    </ol>
                </div>
                
                <h4 style="margin-bottom: 12px;">Changes to be saved:</h4>
                <div class="change-list" id="changeList">
                    Loading changes...
                </div>
                
                <div style="margin-top: 16px;">
                    <label style="font-weight: 600; margin-bottom: 8px; display: block;">JSON Data (auto-generated):</label>
                    <textarea id="jsonOutput" style="width: 100%; height: 200px; padding: 12px; border: 2px solid var(--border); border-radius: 8px; font-family: monospace; font-size: 0.85em;" readonly></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSaveModal()">Cancel</button>
                <button class="btn btn-primary" onclick="copyToClipboard()">üìã Copy JSON</button>
                <button class="btn btn-success" onclick="openGitHub()">üîó Open GitHub</button>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURATION - UPDATE THESE VALUES
        const CONFIG = {
            githubRepo: 'tripfactory-ajay/tripfactory-ajay.github.io', // Format: owner/repo
            dataPath: 'data/org-structure.json',
            githubBranch: 'main'
        };

        // Build URLs
        const RAW_URL = `https://raw.githubusercontent.com/${CONFIG.githubRepo}/${CONFIG.githubBranch}/${CONFIG.dataPath}`;
        const EDIT_URL = `https://github.com/${CONFIG.githubRepo}/edit/${CONFIG.githubBranch}/${CONFIG.dataPath}`;
        
        // State
        let originalData = [];
        let currentData = [];
        let undoStack = [];
        let changes = [];

        // Embedded fallback data (your full dataset)
        const FALLBACK_DATA = [
            { id: 1, name: "Vinay Gupta", role: "Founder & CEO", dept: "management", isManager: true, isExecutive: true },
            { id: 2, name: "Raj Kumar", role: "COO (Chief Operating Officer)", dept: "management", isManager: true, isExecutive: true },
            { id: 3, name: "Ajay Kawa", role: "BTO (Business Transition Officer)", dept: "management", isManager: true, isExecutive: true },
            { id: 4, name: "Amit Aggarwal", role: "Co-Founder (Tech)", dept: "management", isManager: true, isExecutive: true },
            { id: 5, name: "Ankit Agarwal", role: "Co-Founder (Procurement)", dept: "management", isManager: true, isExecutive: true },
            { id: 6, name: "Ankush Agarwal", role: "Co-Founder (People & Marketing)", dept: "management", isManager: true, isExecutive: true },
            { id: 7, name: "Varun Gupta", role: "Co-Founder (Tech)", dept: "management", isManager: true, isExecutive: true },
            { id: 8, name: "Vikas Sharma", role: "CEO's Office", dept: "management", isManager: true, isExecutive: false },
            { id: 9, name: "Vandana Mishra", role: "CEO's Office", dept: "management", isManager: true, isExecutive: false },
            { id: 10, name: "Lalitha P", role: "Country Manager - India", dept: "management", isManager: true, isExecutive: false },
            { id: 11, name: "Rahul Narayan", role: "Chief People Officer", dept: "management", isManager: true, isExecutive: false },
            { id: 12, name: "Yogesh Mehta", role: "Chief Commercial Officer", dept: "management", isManager: true, isExecutive: false },
            { id: 13, name: "Tonney Sharma", role: "Head of Quality", dept: "management", isManager: true, isExecutive: false },
            { id: 14, name: "Seema Tabbasum", role: "VP - Business Partnership", dept: "management", isManager: true, isExecutive: false },
            // ... [Include all 416 employees here - truncated for brevity] ...
            // Add all your employee data here as fallback
        ];

        // Initialize
        async function initialize() {
            showToast('Loading data...', 'info');
            
            try {
                const response = await fetch(RAW_URL + '?t=' + Date.now());
                if (response.ok) {
                    const data = await response.json();
                    originalData = JSON.parse(JSON.stringify(data.data || data));
                    showToast('Loaded from GitHub', 'success');
                } else {
                    throw new Error('GitHub fetch failed');
                }
            } catch (e) {
                console.log('Using fallback data');
                originalData = JSON.parse(JSON.stringify(FALLBACK_DATA));
                showToast('Using local backup data', 'warning');
            }
            
            currentData = JSON.parse(JSON.stringify(originalData));
            undoStack = [JSON.parse(JSON.stringify(originalData))];
            refreshAll();
        }

        // Toast notifications
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            const icons = { success: '‚úÖ', warning: '‚ö†Ô∏è', error: '‚ùå', info: '‚ÑπÔ∏è' };
            toast.innerHTML = `<span style="font-size: 1.2em;">${icons[type]}</span><span>${message}</span>`;
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        // Track changes
        function trackChange(person, field, oldValue, newValue) {
            const change = {
                id: person.id,
                name: person.name,
                field: field,
                oldValue: oldValue,
                newValue: newValue,
                time: new Date().toLocaleString()
            };
            
            // Remove duplicate changes for same person/field
            changes = changes.filter(c => !(c.id === person.id && c.field === field));
            changes.push(change);
            
            updatePendingChanges();
        }

        function updatePendingChanges() {
            const indicator = document.getElementById('pendingChanges');
            const count = document.getElementById('changeCount');
            
            if (changes.length > 0) {
                indicator.classList.add('active');
                count.textContent = changes.length;
            } else {
                indicator.classList.remove('active');
            }
            
            document.getElementById('header-modified').textContent = changes.length;
        }

        // Undo
        function undoLastChange() {
            if (undoStack.length <= 1) {
                showToast('Nothing to undo', 'warning');
                return;
            }
            undoStack.pop();
            currentData = JSON.parse(JSON.stringify(undoStack[undoStack.length - 1]));
            changes = [];
            updatePendingChanges();
            refreshAll();
            showToast('Undo successful', 'info');
        }

        function pushState() {
            undoStack.push(JSON.parse(JSON.stringify(currentData)));
            if (undoStack.length > 20) undoStack.shift();
        }

        // Update functions
        function updatePersonDept(select, id) {
            const person = currentData.find(p => p.id === id);
            const original = originalData.find(p => p.id === id);
            if (person && select.value !== person.dept) {
                pushState();
                const oldDept = person.dept;
                person.dept = select.value;
                trackChange(person, 'Department', oldDept, select.value);
                refreshAll();
                showToast(`${person.name} moved to ${select.value}`, 'success');
            }
        }

        function updatePersonRole(select, id) {
            const person = currentData.find(p => p.id === id);
            if (person) {
                pushState();
                let newRole = select.value;
                if (select.value === 'CUSTOM') {
                    newRole = prompt('Enter custom role:', person.role);
                    if (!newRole) return;
                }
                const oldRole = person.role;
                person.role = newRole;
                trackChange(person, 'Role', oldRole, newRole);
                refreshAll();
            }
        }

        function toggleBusiness(cb, id, type) {
            const person = currentData.find(p => p.id === id);
            if (person) {
                pushState();
                if (!person.business) person.business = [];
                const hadIt = person.business.includes(type);
                if (cb.checked && !hadIt) {
                    person.business.push(type);
                    trackChange(person, 'Business', person.business.join(', '), [...person.business, type].join(', '));
                } else if (!cb.checked && hadIt) {
                    person.business = person.business.filter(t => t !== type);
                    trackChange(person, 'Business', [...person.business, type].join(', '), person.business.join(', '));
                }
                cb.parentElement.classList.toggle('checked', cb.checked);
                refreshAll();
            }
        }

        function updateReportsTo(select, id) {
            const person = currentData.find(p => p.id === id);
            if (person) {
                pushState();
                const oldReportsTo = person.reportsTo || '(none)';
                person.reportsTo = select.value;
                trackChange(person, 'Reports To', oldReportsTo, select.value || '(none)');
            }
        }

        function toggleInactive(id) {
            const person = currentData.find(p => p.id === id);
            if (person) {
                pushState();
                person.inactive = !person.inactive;
                trackChange(person, 'Status', person.inactive ? 'Active' : 'Inactive', person.inactive ? 'Inactive' : 'Active');
                refreshAll();
                showToast(`${person.name} marked as ${person.inactive ? 'inactive' : 'active'}`, person.inactive ? 'warning' : 'success');
            }
        }

        // Save modal
        function openSaveModal() {
            if (changes.length === 0) {
                showToast('No changes to save', 'info');
                return;
            }
            
            const modal = document.getElementById('saveModal');
            const changeList = document.getElementById('changeList');
            const jsonOutput = document.getElementById('jsonOutput');
            
            // Build change list HTML
            changeList.innerHTML = changes.map(c => `
                <div class="change-item">
                    <strong>${c.name}</strong>: ${c.field}<br>
                    <span style="color: #e53e3e; text-decoration: line-through;">${c.oldValue}</span> ‚Üí 
                    <span style="color: #38a169; font-weight: 600;">${c.newValue}</span>
                </div>
            `).join('');
            
            // Generate JSON
            const exportData = {
                timestamp: new Date().toISOString(),
                exportedBy: 'Lalitha P',
                version: '2.0',
                changes: changes,
                data: currentData
            };
            
            jsonOutput.value = JSON.stringify(exportData, null, 2);
            modal.classList.add('active');
        }

        function closeSaveModal() {
            document.getElementById('saveModal').classList.remove('active');
        }

        function copyToClipboard() {
            const jsonOutput = document.getElementById('jsonOutput');
            jsonOutput.select();
            document.execCommand('copy');
            showToast('JSON copied to clipboard!', 'success');
        }

        function openGitHub() {
            window.open(EDIT_URL, '_blank');
        }

        // Render functions (same as before)
        function getDeptOptions(selected) {
            const depts = {
                management: 'üëî Management',
                tech: 'üíª Tech',
                finance: 'üí∞ Finance',
                marketing: 'üì¢ Marketing',
                sales: 'üíº Sales',
                operations: '‚öôÔ∏è Operations',
                hr: 'üë• HR',
                commercial: 'ü§ù Commercial'
            };
            return Object.entries(depts).map(([val, label]) => 
                `<option value="${val}" ${val === selected ? 'selected' : ''}>${label}</option>`
            ).join('');
        }

        function getRoleOptions(selected) {
            const roles = [...new Set(originalData.map(p => p.role))].sort();
            let html = `<option value="">Select Role...</option>`;
            roles.forEach(r => html += `<option value="${r}" ${r === selected ? 'selected' : ''}>${r}</option>`);
            html += `<option value="CUSTOM">‚úèÔ∏è Custom...</option>`;
            return html;
        }

        function renderLeadership() {
            const container = document.getElementById('leadership-grid');
            const executives = currentData.filter(p => p.isExecutive && !p.inactive);
            
            container.innerHTML = executives.map(person => `
                <div class="leader-card" data-id="${person.id}">
                    <div class="leader-header">
                        <div>
                            <div class="leader-name">${person.name}</div>
                            <div class="leader-role">${person.role}</div>
                        </div>
                        <span class="leader-badge">EXEC</span>
                    </div>
                    <div class="leader-form">
                        <select class="form-select-dark" onchange="updatePersonDept(this, ${person.id})">
                            ${getDeptOptions(person.dept)}
                        </select>
                        <select class="form-select-dark" onchange="updatePersonRole(this, ${person.id})">
                            ${getRoleOptions(person.role)}
                        </select>
                    </div>
                </div>
            `).join('');
        }

        function renderDepartments() {
            const container = document.getElementById('departments-container');
            const depts = ['management', 'tech', 'finance', 'marketing', 'sales', 'operations', 'hr', 'commercial'];
            const deptNames = { management: 'Management', tech: 'Technology', finance: 'Finance', marketing: 'Marketing', sales: 'Sales', operations: 'Operations', hr: 'HR & People', commercial: 'Commercial' };
            const deptIcons = { management: 'üëî', tech: 'üíª', finance: 'üí∞', marketing: 'üì¢', sales: 'üíº', operations: '‚öôÔ∏è', hr: 'üë•', commercial: 'ü§ù' };

            let html = '';
            depts.forEach(dept => {
                const deptPeople = currentData.filter(p => p.dept === dept && !p.isExecutive && !p.inactive);
                if (deptPeople.length === 0 && dept !== 'management') return;
                
                const byRole = {};
                deptPeople.forEach(p => { if (!byRole[p.role]) byRole[p.role] = []; byRole[p.role].push(p); });
                const sortedRoles = Object.entries(byRole).sort((a, b) => b[1].length - a[1].length);
                
                html += `
                    <div class="dept-section" id="dept-${dept}">
                        <div class="dept-header ${dept}">
                            <div class="dept-title-group">
                                <span class="dept-icon-large">${deptIcons[dept]}</span>
                                <div>
                                    <div class="dept-title">${deptNames[dept]}</div>
                                    <div style="font-size: 0.85em; opacity: 0.9; margin-top: 2px;">${deptPeople.length} people</div>
                                </div>
                            </div>
                            <div class="dept-meta">
                                <div class="dept-meta-item">üë®‚Äçüíº ${deptPeople.filter(p => p.isManager).length} Managers</div>
                                <div class="dept-meta-item">üë• ${deptPeople.filter(p => !p.isManager).length} Staff</div>
                            </div>
                        </div>
                        <div class="dept-body">
                            ${sortedRoles.map(([role, people]) => `
                                <div class="role-group expanded" id="group-${dept}-${role.replace(/[^a-zA-Z0-9]/g, '-')}">
                                    <div class="role-header" onclick="toggleGroup('${dept}-${role.replace(/[^a-zA-Z0-9]/g, '-')}')">
                                        <div class="role-title-section">
                                            <span class="role-count">${people.length}</span>
                                            <span class="role-name">${role}</span>
                                        </div>
                                        <span class="expand-icon">‚ñº</span>
                                    </div>
                                    <div class="role-members">
                                        ${people.map(person => renderPersonCard(person)).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function renderPersonCard(person) {
            return `
                <div class="person-card ${person.inactive ? 'inactive' : ''}" data-id="${person.id}">
                    <div class="person-main">
                        <div class="person-name">${person.name}</div>
                    </div>
                    <div class="person-form-grid">
                        <select class="form-control" onchange="updatePersonDept(this, ${person.id})">
                            ${getDeptOptions(person.dept)}
                        </select>
                        <select class="form-control" onchange="updatePersonRole(this, ${person.id})">
                            ${getRoleOptions(person.role)}
                        </select>
                        <div class="checkbox-group-inline">
                            <label class="checkbox-pill ${(person.business || []).includes('B2B') ? 'checked' : ''}">
                                <input type="checkbox" onchange="toggleBusiness(this, ${person.id}, 'B2B')" ${(person.business || []).includes('B2B') ? 'checked' : ''}> B2B
                            </label>
                            <label class="checkbox-pill ${(person.business || []).includes('B2C') ? 'checked' : ''}">
                                <input type="checkbox" onchange="toggleBusiness(this, ${person.id}, 'B2C')" ${(person.business || []).includes('B2C') ? 'checked' : ''}> B2C
                            </label>
                            <label class="checkbox-pill ${(person.business || []).includes('TourOp') ? 'checked' : ''}">
                                <input type="checkbox" onchange="toggleBusiness(this, ${person.id}, 'TourOp')" ${(person.business || []).includes('TourOp') ? 'checked' : ''}> TourOp
                            </label>
                        </div>
                        <select class="form-control" onchange="updateReportsTo(this, ${person.id})">
                            <option value="">Reports to...</option>
                            ${currentData.filter(p => p.isManager && !p.inactive).map(m => 
                                `<option value="${m.name}" ${(person.reportsTo || '') === m.name ? 'selected' : ''}>${m.name}</option>`
                            ).join('')}
                        </select>
                    </div>
                    <div class="person-actions">
                        <button class="action-btn validate" onclick="validatePerson(this, true)" title="Mark as Correct">‚úì</button>
                        <button class="action-btn reject" onclick="validatePerson(this, false)" title="Mark for Review">‚úó</button>
                        <button class="action-btn inactive-btn ${person.inactive ? 'active' : ''}" onclick="toggleInactive(${person.id})" title="Toggle Inactive">‚ö†Ô∏è</button>
                    </div>
                </div>
            `;
        }

        function toggleGroup(id) {
            const group = document.getElementById(`group-${id}`);
            if (group) group.classList.toggle('expanded');
        }

        function expandAll() { document.querySelectorAll('.role-group').forEach(g => g.classList.add('expanded')); }
        function collapseAll() { document.querySelectorAll('.role-group').forEach(g => g.classList.remove('expanded')); }
        
        function scrollToDept(dept) {
            const el = document.getElementById(`dept-${dept}`) || document.getElementById('leadership');
            if (el) {
                el.scrollIntoView({ behavior: 'smooth', block: 'start' });
                document.querySelectorAll('.dept-nav-item').forEach(i => i.classList.remove('active'));
                document.querySelector(`.dept-nav-item[data-dept="${dept}"]`)?.classList.add('active');
            }
        }

        function validatePerson(btn, isValid) {
            const card = btn.closest('.person-card');
            card.querySelectorAll('.action-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            card.style.borderLeft = isValid ? '4px solid #38a169' : '4px solid #e53e3e';
        }

        function handleSearch(query) {
            if (!query) {
                document.querySelectorAll('.person-card').forEach(card => {
                    card.style.display = '';
                    card.classList.remove('highlighted');
                });
                return;
            }
            const lowerQuery = query.toLowerCase();
            document.querySelectorAll('.person-card').forEach(card => {
                const name = card.querySelector('.person-name').textContent.toLowerCase();
                if (name.includes(lowerQuery)) {
                    card.style.display = '';
                    card.classList.add('highlighted');
                    card.closest('.role-group')?.classList.add('expanded');
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function updateQuickStats() {
            const active = currentData.filter(p => !p.inactive).length;
            document.getElementById('header-active').textContent = active;
            
            const depts = ['management', 'tech', 'finance', 'marketing', 'sales', 'operations', 'hr', 'commercial'];
            depts.forEach(dept => {
                const count = currentData.filter(p => p.dept === dept && !p.isExecutive && !p.inactive).length;
                const el = document.getElementById(`quick-${dept}`);
                if (el) el.textContent = count;
            });
        }

        function refreshAll() {
            renderLeadership();
            renderDepartments();
            updateQuickStats();
        }

        // Initialize
        initialize();
    </script>
</body>
</html>
